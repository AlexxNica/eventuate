

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Architecture &mdash; Eventuate</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Eventuate" href="index.html"/>
        <link rel="next" title="Download" href="download.html"/>
        <link rel="prev" title="Introduction" href="introduction.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> Eventuate</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#event-logs">Event logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#event-sourced-actors">Event-sourced actors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#event-sourced-views">Event-sourced views</a></li>
<li class="toctree-l2"><a class="reference internal" href="#event-sourced-processors">Event-sourced processors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#operation-based-crdts">Operation-based CRDTs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vector-clocks">Vector clocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#batching">Batching</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adapters">Adapters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="download.html">Download</a><ul>
<li class="toctree-l2"><a class="reference internal" href="download.html#binaries">Binaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="download.html#sources">Sources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user-guide.html">User guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#event-sourced-actors">Event-sourced actors</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#detecting-concurrent-updates">Detecting concurrent updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#tracking-conflicting-versions">Tracking conflicting versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#resolving-conflicting-versions">Resolving conflicting versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#operation-based-crdts">Operation-based CRDTs</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#event-sourced-views">Event-sourced views</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#conditional-commands">Conditional commands</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reference/api-docs.html">API docs</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-log.html">Event log</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html">Event-sourced actors</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#event-sourced-views">Event-sourced views</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#state-recovery">State recovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#event-routing">Event routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#reliable-delivery">Reliable delivery</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#snapshots">Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/configuration.html">Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="developers.html#contributing-to-eventuate">Contributing to Eventuate</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers.html#building-eventuate">Building Eventuate</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="project.html">Project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="project.html#community">Community</a></li>
<li class="toctree-l2"><a class="reference internal" href="project.html#license">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="articles.html">Articles</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-application.html">Example application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example-application.html#domain">Domain</a></li>
<li class="toctree-l2"><a class="reference internal" href="example-application.html#replication">Replication</a></li>
<li class="toctree-l2"><a class="reference internal" href="example-application.html#interface">Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="example-application.html#running">Running</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="current-limitations.html">Current limitations</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Eventuate</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Architecture</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/architecture.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="architecture">
<span id="id1"></span><h1>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h1>
<p>The following sections give an overview of the main functional building blocks of Eventuate. Further details are given in the <a class="reference internal" href="user-guide.html#user-guide"><span>User guide</span></a> and <a class="reference internal" href="reference.html#reference"><span>Reference</span></a>.</p>
<div class="section" id="event-logs">
<span id="id2"></span><h2>Event logs<a class="headerlink" href="#event-logs" title="Permalink to this headline">¶</a></h2>
<p>Eventuate applications store events in event logs. An event log can be replicated across <em>locations</em> where each location has its own copy of events in a local event log. Replication occurs asynchronously over <em>replication connections</em> between <em>replication endpoints</em>.</p>
<div class="figure" id="id11" style="width: 70%">
<img alt="_images/architecture-1.png" src="_images/architecture-1.png" />
<p class="caption"><span class="caption-text">Fig. 1</span></p>
<div class="legend">
An event log, replicated across locations 1, 2 and 3.</div>
</div>
<p>Events within a local log are totally ordered. This total order however is likely to differ among locations, as events can be written concurrently. The strongest ordering guarantee that can be given across locations is <a class="reference external" href="http://krasserm.github.io/2015/01/13/event-sourcing-at-global-scale/#event-log">causal ordering</a><a class="footnote-reference" href="#id9" id="id3">[1]</a> which is tracked with <a class="reference external" href="http://en.wikipedia.org/wiki/Vector_clock">vector clocks</a>. Causal ordering is guaranteed to be consistent with total ordering in local event logs.</p>
<p>A replication endpoint can also manage more than one local event log. Event logs are indexed by name and replication occurs only between logs of the same name. Logs with different names are isolated from each other<a class="footnote-reference" href="#id10" id="id4">[2]</a> and their distribution across locations may differ, as shown in the following figure.</p>
<div class="figure" id="id12" style="width: 70%">
<img alt="_images/architecture-2.png" src="_images/architecture-2.png" />
<p class="caption"><span class="caption-text">Fig. 2</span></p>
<div class="legend">
Three replicated event logs. Log X (blue) is replicated across locations 1, 2 and 3. Log Y (red) is replicated across locations 1 and 2 and log Z (green) is replicated across locations 1 and 3.</div>
</div>
<p>Eventuate event logs are comparable to <a class="reference external" href="https://kafka.apache.org/">Apache Kafka</a> topics. The main difference is that Kafka chooses consistency over write-availability for replicated topics whereas Eventuate chooses write-availability over consistency for replicated event logs, giving up total ordering for causal ordering.</p>
<p>Event storage backends at individual locations are pluggable. A location that requires strong durability guarantees should use a storage backend that is (synchronously) replicated within that location (<a class="reference external" href="https://kafka.apache.org/">Apache Kafka</a> is an good fit here), others may use a more lightweight, non-replicated storage backend in case of weaker durability requirements.</p>
<p>Event replication across locations is reliable. Should a location crash or a network partition occur, replication automatically resumes when crashed location recovers and/or the partition heals. Built-in failure detectors inform applications about (un)availability of other locations. Replication endpoints also ensure that no duplicates are ever written to target event logs.</p>
<p>Replication connections can be configured with replication filters, so that only events matching one or more filter criteria are replicated. This is especially useful for smaller locations (for example, a mobile device) that only needs to exchange a subset of events with other locations.</p>
</div>
<div class="section" id="event-sourced-actors">
<h2>Event-sourced actors<a class="headerlink" href="#event-sourced-actors" title="Permalink to this headline">¶</a></h2>
<p>Event-sourced actors produce events to and consume events from an event log. During <em>command processing</em> they usually validate external commands against internal state and, if validation succeeds, write one or more events to their event log. During <em>event processing</em> they consume events they have written and update internal state by handling these events. This is the basic idea behind <a class="reference external" href="http://martinfowler.com/eaaDev/EventSourcing.html">event sourcing</a>. When used in context of a <a class="reference external" href="http://martinfowler.com/bliki/CQRS.html">CQRS</a> architecture, event-sourced actors usually implement the command-side (C).</p>
<div class="figure" id="id13" style="width: 70%">
<img alt="_images/architecture-3.png" src="_images/architecture-3.png" />
<p class="caption"><span class="caption-text">Fig. 3</span></p>
<div class="legend">
An event-sourced actor, producing events to and consuming events from an event log.</div>
</div>
<p>When an event-sourced actor is re-started, internal state is recovered by replaying events from its local event log. Since events in a local event log are totally ordered, event replay at a given location is deterministic. Event replay can also be started from a snapshot of internal state which is an optimization to reduce recovery times.</p>
<p>In addition to consuming their own events, event-sourced actors can also consume events produced by other event-sourced actors to the same event log. This enables <a class="reference external" href="http://martinfowler.com/eaaDev/EventCollaboration.html">event collaboration</a> between actors (<a class="reference internal" href="#arch-fig4"><span>Fig. 4</span></a>). The underlying event routing rules can be customized by applications.</p>
<p>A special form of event collaboration is state replication where actors of the same type consume the same events at different locations to re-construct state. Another example of event collaboration is a distributed business process where actors of different type collaborate by exchanging events to achieve a common goal.</p>
<div class="figure" id="id14" style="width: 70%">
<span id="arch-fig4"></span><img alt="_images/architecture-4.png" src="_images/architecture-4.png" />
<p class="caption"><span class="caption-text">Fig. 4</span></p>
<div class="legend">
Two event-sourced actors exchanging events over a distributed event log.</div>
</div>
<p>Event-sourced actors may also interact with external services by sending commands and processing replies. Commands can be sent with at-most-once or at-least-once delivery semantics, depending on the reliability requirements of an application. Replies from external services are usually processed like external commands which may result in further events to be written. This way, external services can be included into reliable, event-driven business processes controlled by event-sourced actors.</p>
<div class="figure" id="id15" style="width: 70%">
<img alt="_images/architecture-5.png" src="_images/architecture-5.png" />
<p class="caption"><span class="caption-text">Fig. 5</span></p>
<div class="legend">
External service integration.</div>
</div>
<p>From a functional perspective, there’s no difference whether event-sourced actors exchange events over a local event log or over a distributed event log. This is also useful for testing purposes as it doesn’t require to setup a distributed log.</p>
</div>
<div class="section" id="event-sourced-views">
<h2>Event-sourced views<a class="headerlink" href="#event-sourced-views" title="Permalink to this headline">¶</a></h2>
<p>Event-sourced views are a functional subset of event-sourced actors. They can only consume events from an event log but cannot produce new events. Views do not only maintain state in-memory but often persist it to a database. By additionally storing the sequence number of the last processed event in the database, writing can be made idempotent. When used in context of a <a class="reference external" href="http://martinfowler.com/bliki/CQRS.html">CQRS</a> architecture, views implement the query-side (Q).</p>
</div>
<div class="section" id="event-sourced-processors">
<span id="processors"></span><h2>Event-sourced processors<a class="headerlink" href="#event-sourced-processors" title="Permalink to this headline">¶</a></h2>
<p>An event-sourced processor consumes events from one or more event logs, processes them (stateless or stateful) and produces the processed events to another event log. Event-sourced processors are gateways between otherwise partitioned event logs. They are not implemented yet but coming soon.</p>
</div>
<div class="section" id="operation-based-crdts">
<span id="id5"></span><h2>Operation-based CRDTs<a class="headerlink" href="#operation-based-crdts" title="Permalink to this headline">¶</a></h2>
<p>Eventuate provides implementations of <a class="reference internal" href="user-guide.html#commutative-replicated-data-types"><span>Operation-based CRDTs</span></a> (commutative replicated data types or CmRDTs) that rely on a replicated event log to reliably broadcast update operations. CmRDTs are managed by <em>CRDT services</em> that provide applications convenient access to CmRDTs. New CmRDT types can be integrated into the CRDT service infrastructure with the CRDT development framework.</p>
</div>
<div class="section" id="vector-clocks">
<span id="id6"></span><h2>Vector clocks<a class="headerlink" href="#vector-clocks" title="Permalink to this headline">¶</a></h2>
<p>An event-sourced actor represents a lightweight “process” with its own consistency boundary. After having consumed an event e<sub>i</sub>, events e<sub>i+1</sub>, e<sub>i+2</sub>, ..., e<sub>i+n</sub> generated by that actor, causally depend on e<sub>i</sub>. To track causality, each event-sourced actor maintains a vector clock which is used to timestamp written events. For any two events, applications can determine if they are causally related or if they are concurrent by comparing their vector timestamps.</p>
<p>Only events that are actually handled by an event-sourced actor update its vector clock. This allows to keep vector clock sizes small, even if a large number of event-sourced actors is used. For example, if an application follows a one-<a class="reference external" href="http://martinfowler.com/bliki/DDD_Aggregate.html">aggregate</a>-per-actor design, vector clock sizes scale only with the (small) number of locations rather than the (potentially large) number of aggregates.</p>
</div>
<div class="section" id="batching">
<span id="id7"></span><h2>Batching<a class="headerlink" href="#batching" title="Permalink to this headline">¶</a></h2>
<p>Eventuate internally uses batching to optimize read and write throughput. It is used for</p>
<ul class="simple">
<li>producing new events to the event log: Whenever a write operation to a an event log is in progress, new write requests are batched and served when the previous write operation completed. This strategy leads to dynamically increasing write-batch sizes (up to a configurable maximum) under increasing write loads. If there is no current write operation in progress, a new write request is served immediately, keeping latency at a minimum.</li>
<li>consuming events from the event log: Events can be read from the event log in batches which allows for efficient integration of external consumers.</li>
<li>replicating events: Events are replicated in batches of configurable size. They are batch-read from a source log, batch-transferred over a replication connection and batch-written to a target log.</li>
</ul>
</div>
<div class="section" id="adapters">
<h2>Adapters<a class="headerlink" href="#adapters" title="Permalink to this headline">¶</a></h2>
<p>Eventuate aims to integrate with stream processing solutions such as Spark Streaming, Storm or Samza. The ability to exchange events with these solutions enables support for many analytics use cases. We plan to provide adapters for</p>
<ul class="simple">
<li><a class="reference external" href="https://spark.apache.org/streaming/">Spark Streaming</a></li>
<li><a class="reference external" href="http://samza.apache.org/">Samza</a></li>
<li><a class="reference external" href="https://storm.apache.org/">Storm</a></li>
<li><a class="reference external" href="http://doc.akka.io/docs/akka-stream-and-http-experimental/current/scala.html">akka-streams</a></li>
<li><a class="reference external" href="https://github.com/scalaz/scalaz-stream">scalaz-stream</a></li>
</ul>
<p>We haven’t started yet working on this. Should you have any preferences or proposals for further integrations, please <a class="reference external" href="https://groups.google.com/forum/#!forum/eventuate">let us know</a>. Of course, we love contributions :)</p>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[1]</a></td><td>In the linked article, the term <em>site</em> is synonymous with <em>location</em>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td><a class="reference internal" href="#processors"><span>Event-sourced processors</span></a> can be used to connect partitioned event logs.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="download.html" class="btn btn-neutral float-right" title="Download">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral" title="Introduction"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015 Red Bull Media House.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1-SNAPSHOT',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>